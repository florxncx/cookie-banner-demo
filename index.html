
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Strict Tracking Demo</title>
</head>
<body style="font-family: Arial, sans-serif; background: #f0f4f8; margin: 0; padding: 0;">

    <div style="text-align: center; margin-top: 50px;">
        <img src="https://via.placeholder.com/150x50?text=Your+Logo" alt="Company Logo" style="margin-bottom: 20px;">
        <h1 style="color: #333;">Welcome to Our Website</h1>
        <p style="color: #555;">We only track usage data after you provide consent and your email.</p>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; width: 100%; background: #007bff; color: #fff; padding: 16px; font-family: Arial, sans-serif; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 9999; text-align: center;">
        <p style="margin: 0;">We use cookies to analyze traffic and track your time on site, associating this data with your email for analytics and marketing purposes. By clicking <strong>"Accept"</strong>, you consent to tracking in accordance with our 
        <a href="privacy-policy.html" style="color: #ffc107; text-decoration: underline;">Privacy Policy</a>.</p>
        <div style="margin-top: 10px;">
            <button id="accept-btn" style="margin-right: 10px; padding: 10px 20px; background: #28a745; color: #fff; border: none; border-radius: 5px; cursor: pointer;">Accept</button>
            <button id="reject-btn" style="padding: 10px 20px; background: #6c757d; color: #fff; border: none; border-radius: 5px; cursor: pointer;">Reject</button>
        </div>
    </div>

    <!-- Email Form with branding and modern style -->
    <div id="email-form" style="
        display:none; 
        margin: 60px auto; 
        max-width: 400px; 
        padding: 30px; 
        background: #ffffff; 
        border: 1px solid #e0e0e0; 
        border-radius: 10px; 
        box-shadow: 0 6px 15px rgba(0,0,0,0.1); 
        text-align: center;
    ">
        <h2 style="margin-bottom: 10px; color: #007bff;">Stay Connected</h2>
        <p style="font-size: 15px; color: #555; margin-bottom: 20px;">
            Provide your email to receive marketing emails, first-hand insights, and exclusive updates.
        </p>
        <form id="subscribe-form" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <input 
                type="email" 
                id="user-email" 
                placeholder="you@example.com" 
                required 
                style="flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 5px; width: 100%; max-width: 250px;"
            />
            <button 
                type="submit" 
                style="padding: 12px 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease;"
                onmouseover="this.style.backgroundColor='#0056b3';" 
                onmouseout="this.style.backgroundColor='#007bff';"
            >
                Subscribe
            </button>
        </form>
        <p id="confirm" style="margin-top: 15px; font-size: 14px; color: #28a745;"></p>
    </div>

    <script>
        const startTime = Date.now();
        let clickCount = 0;

        document.getElementById('accept-btn').onclick = () => {
            localStorage.setItem('trackingConsent', 'yes');
            document.getElementById('cookie-banner').style.display = 'none';
            document.getElementById('email-form').style.display = 'block';
        };

        document.getElementById('reject-btn').onclick = () => {
            localStorage.setItem('trackingConsent', 'no');
            document.getElementById('cookie-banner').style.display = 'none';
        };

        document.getElementById('subscribe-form').onsubmit = e => {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            localStorage.setItem('userEmail', email);
            document.getElementById('email-form').innerHTML = "<p style='color:#28a745;font-weight:bold;'>âœ… Email saved. Tracking will now begin and be associated with your email.</p>";
            window.addEventListener('beforeunload', sendTrackingData);
        };

        document.addEventListener('click', () => {
            if(localStorage.getItem('trackingConsent') === 'yes' && localStorage.getItem('userEmail')) {
                clickCount++;
            }
        });

        function sendTrackingData() {
            if(!localStorage.getItem('userEmail')) return;
            const timeSpent = Math.round((Date.now() - startTime) / 1000); 
            const scrollDepth = Math.round((window.scrollY + window.innerHeight) / document.body.scrollHeight * 100);

            fetch('https://script.google.com/macros/s/AKfycbyuachUxcv5hYieODYjf9sdr6_0CUkVEr1JjPh3_AhJHdZIz-qHwv1NCKBQaIj2IVeh9g/exec', {
                method: 'POST',
                body: JSON.stringify({
                    email: localStorage.getItem('userEmail'),
                    page: window.location.pathname,
                    timeSpent: timeSpent,
                    scrollDepth: scrollDepth,
                    clickCount: clickCount
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => console.log('Strict tracking data sent.')).catch(err => console.error(err));
        }

        if(localStorage.getItem('trackingConsent') === 'yes' && localStorage.getItem('userEmail')) {
            window.addEventListener('beforeunload', sendTrackingData);
            document.getElementById('cookie-banner').style.display = 'none';
        } else if(localStorage.getItem('trackingConsent') === 'no') {
            document.getElementById('cookie-banner').style.display = 'none';
        }
    </script>
</body>
</html>
