
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Strict Tracking Demo</title>
</head>
<body>
    <h1>Welcome to Our Website (Strict Tracking)</h1>
    <p>We track usage data only after you provide consent and your email.</p>

    <!-- Cookie Consent Banner -->
    <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; width: 100%; background: #f1f1f1; padding: 16px; font-family: Arial, sans-serif; border-top: 1px solid #ccc; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 9999;">
        <p>We use cookies to analyze traffic and track your time on site, associating this data with your email for analytics and marketing purposes. By clicking <strong>"Accept"</strong>, you consent to tracking in accordance with our 
        <a href="privacy-policy.html" style="color: #007bff;">Privacy Policy</a>.</p>
        <button id="accept-btn" style="margin-right: 10px; padding: 8px 16px; background: #007bff; color: #fff; border: none; border-radius: 4px;">Accept</button>
        <button id="reject-btn" style="padding: 8px 16px; background: #6c757d; color: #fff; border: none; border-radius: 4px;">Reject</button>
    </div>

    <!-- Email Form -->
    <div id="email-form" style="display:none; margin-top:20px;">
        <p>Please enter your email to allow us to associate tracking data with you:</p>
        <form id="subscribe-form">
            <input type="email" id="user-email" placeholder="Your email" required />
            <button type="submit">Submit</button>
        </form>
        <p id="confirm"></p>
    </div>

    <script>
        const startTime = Date.now();
        let clickCount = 0;

        document.getElementById('accept-btn').onclick = () => {
            localStorage.setItem('trackingConsent', 'yes');
            document.getElementById('cookie-banner').style.display = 'none';
            document.getElementById('email-form').style.display = 'block';
        };

        document.getElementById('reject-btn').onclick = () => {
            localStorage.setItem('trackingConsent', 'no');
            document.getElementById('cookie-banner').style.display = 'none';
        };

        document.getElementById('subscribe-form').onsubmit = e => {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            localStorage.setItem('userEmail', email);
            document.getElementById('email-form').innerHTML = "<p>âœ… Email saved. Tracking will now begin and be associated with your email.</p>";
            window.addEventListener('beforeunload', sendTrackingData);
        };

        document.addEventListener('click', () => {
            if(localStorage.getItem('trackingConsent') === 'yes' && localStorage.getItem('userEmail')) {
                clickCount++;
            }
        });

        function sendTrackingData() {
            if(!localStorage.getItem('userEmail')) return;
            const timeSpent = Math.round((Date.now() - startTime) / 1000); 
            const scrollDepth = Math.round((window.scrollY + window.innerHeight) / document.body.scrollHeight * 100);

            fetch('https://script.google.com/macros/s/AKfycbyuachUxcv5hYieODYjf9sdr6_0CUkVEr1JjPh3_AhJHdZIz-qHwv1NCKBQaIj2IVeh9g/exec', {
                method: 'POST',
                body: JSON.stringify({
                    email: localStorage.getItem('userEmail'),
                    page: window.location.pathname,
                    timeSpent: timeSpent,
                    scrollDepth: scrollDepth,
                    clickCount: clickCount
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => console.log('Strict tracking data sent.')).catch(err => console.error(err));
        }

        if(localStorage.getItem('trackingConsent') === 'yes' && localStorage.getItem('userEmail')) {
            window.addEventListener('beforeunload', sendTrackingData);
            document.getElementById('cookie-banner').style.display = 'none';
        } else if(localStorage.getItem('trackingConsent') === 'no') {
            document.getElementById('cookie-banner').style.display = 'none';
        }
    </script>
</body>
</html>
